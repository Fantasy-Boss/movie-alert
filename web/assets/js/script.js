var searchUrl="",discoverPage=1,trendingPage=1,searchPage=1,isBusy=!1;totalPage=100,currentTab="discover",fetchActive=!1,lastOne={},search="",year="",lang="",genre="",region="",widthCount=0,$(document).ready(function(){if(navigator.onLine){getData("discover"),getSearchData(),$(".hover, .hover .hover-close").click(e=>{$(".hover").fadeOut(100)}),$(".tube, .tube .tube-close").click(e=>{$(".tube").fadeOut(100),$(".tube .tube-cover").empty()}),$(".hover .hover-content, .tube .tube-cover").click(e=>{e.stopPropagation()});let e=0,t=!0,a="";for(let s=0;s<100;s++)t?(t=!1,a+=`.progress-circle.p${s+1} .value-bar {transform:rotate(${e+=4}deg)}`):(parseInt(s/5)==s/5?e+=4:e+=3,t=!0,a+=`.progress-circle.p${s+1} .value-bar {transform:rotate(${e}deg)}`);$("style").append(a),$(window).scroll(()=>{$(window).scrollTop()+$(window).height()>$("body").height()-200&&!isBusy&&"wish"!=currentTab&&!fetchActive&&getData(currentTab)}),$("#main-search-btn input").click(e=>{searchPage=1,widthCount=0,isBusy=!1,$(".posts").empty(),load(),search=""!=$(".search-input").val()?`&search=${encodeURI($(".search-input").val())}`:"",genre=0!=$("#genre").val()?`&genre=${$("#genre").val()}`:"",year=0!=$("#year").val()?`&year=${$("#year").val()}`:"",lang=0!=$("#lang").val()?`&lang=${$("#lang").val()}`:"",region=0!=$("#region").val()?`&region=${$("#region").val()}`:"",searchUrl=`/api/search/${searchPage}?${lang}${year}${genre}${region}${search}`,getData("search")}),$(".header .item i").click(e=>{let t=$(e.target).parent();widthCount=0,t.hasClass("active")||($(".hover").fadeOut(100),$(".tube").fadeOut(100),$(".header .item").removeClass("active"),t.hasClass("search")?(currentTab="search",isBusy=!0,t.addClass("active"),load("rm"),$(".posts").empty(),searchPage=1,$(".search-box").fadeIn(300),setTimeout(load("rm"),2e3)):(isBusy=!1,$(".search-box").fadeOut(100),t.hasClass("home")?(t.addClass("active"),load(),$(".posts").empty(),discoverPage=1,currentTab="discover",getData("discover")):t.hasClass("trend")?(t.addClass("active"),load(),$(".posts").empty(),trendingPage=1,currentTab="trend",getData("trend")):t.hasClass("wish")&&(currentTab="wish",t.addClass("active"),load("rm"),showWish(getWish()))))})}else $(".posts").html("<br><br><br><br><h1>No Internet Connection</h1>"),load("rm")});const getData=async e=>{fetchActive=!0,url=searchUrl,load(),"search"!=e&&(url="trend"==e?`/api/trending/${trendingPage}`:`/api/movies/${discoverPage}`),fetch(url).then(e=>e.json()).then(t=>{"search"==currentTab&&load("rm"),"trend"==e?trendingPage+=1:"search"==e?(searchPage+=1,searchUrl=searchUrl.replace(`/search/${searchPage-1}`,`/search/${searchPage}`)):discoverPage+=1;let a="";if(t.length>0){for(let e of t)a+=formatData(e);$(".posts").append(a)}else $(".posts").html("<br><br><br><br><h1>No Results</h1>");fetchActive=!1,eventHandeler(),0==widthCount&&widthCheck()}).catch(()=>fetchActive=!1)},formatData=e=>{let t=new Date(e.release_date).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric"}),a=10*e.vote_average.toFixed(1);return html=`<div oncontextmenu="return false" class="post" id="${e.id}">\n\t\t\t\t<div class="cover"></div>\n\t\t\t\t<img src="https://www.themoviedb.org/t/p/w220_and_h330_face/${e.poster_path}" \n\t\t\t\talt="${e.title}">\n\t\t\t\t<div class="back">\n\t\t\t\t\t<div class="all">\n\t\t\t\t\t\t<div class="title">${e.title}</div>\n\t\t\t\t\t\t<div class="rating">\n\t\t\t\t\t\t\t<div class="progress-circle ${a>=50?"over50":""} p${a}">\n\t\t\t\t\t\t\t\t<span>${a}%</span>\n\t\t\t\t\t\t\t\t<div class="left-half-clipper">\n\t\t\t\t\t\t\t\t\t<div class="first50-bar"></div>\n\t\t\t\t\t\t\t\t\t<div class="value-bar"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="date">${t}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>`,html},eventHandeler=()=>{$(".post .cover").unbind(),$(".post .cover").hover(e=>{$(e.target).parent().children(".back").fadeIn(300)},e=>{$(e.target).parent().children(".back").fadeOut(300)}),$(".post .cover").click(e=>{$(".hover").fadeIn(200),$(".hover-content").children(".load").length<1&&$(".hover-content").append('<div class="load">\n                            <div class="load-div"><div class="loader"></div></div>\n                        </div>'),$(".hover .img, .hover .details").remove(),single(`/api/movie/${$(e.target).parent().attr("id")}`)})},single=e=>{fetch(e).then(e=>e.json()).then(e=>{$(".hover .load, .hover .img, .hover .details").remove(),lastOne=e;let t=new Date(e.release_date).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric"}),a=new Date(e.release_date).toLocaleString("en-US",{year:"numeric"}),s="";e.genres.forEach(e=>s+=e.name+", "),s=s.slice(0,s.length-2);let r=0,i=e.runtime;for(;i>60;)r+=1,i-=60;let n=`${r}h ${i}m`,l="my-heart-empty",o=getWish();for(let t of o.data)t.id===e.id&&(l="my-heart");let c=e.videos.results[0]?`<i class="my-dot"></i><i data-id="${e.videos.results[0].key}" \n\tclass="my-youtube"> Play Trailer</i>`:"";$(".hover-content").append(`<div class="img noselect">\n                            <img draggable="false" src="https://image.tmdb.org/t/p/w300${e.poster_path}" alt="${e.title}">\n                        </div>\n                        <div class="details">\n                            <div class="title">${e.title} (${a})</div>\n                            <div class="mini noselect">${t}<i class="my-dot"></i>${s}<i class="my-dot"></i>${n}\n                            </div>\n                            <div class="extra noselect">\n                                <div class="rating">${10*e.vote_average.toFixed(1)}%</div><i class="my-dot"></i>\n                                <i class="wish ${l}"></i><i class="my-dot"></i>\n                                <a class="imdb" draggable="false" href="https://www.imdb.com/title/${e.imdb_id}" target="_blank">\n                                    <img draggable="false" src="data:image/png;base64,\n                                    iVBORw0KGgoAAAANSUhEUgAAAJcAAABPCAMAAADRLKc\n                                    JAAAAgVBMVEX1xRgAAAD5yBj+zBmggA9HOgdpVQruvxfXrR\n                                    U1KgUPDAHitRbCnBP///9BNAbnuRcpIARyXAutixHSqRX1w\n                                    wD++OT64Jb3z0X2yCT523z52nb63o25lRJ7YwzLoxRVRAj/0xoiGwNcSgkvJgQ6LwWYeg8XEgIcFwKOcg5PPwiGaw3PDhCWAAADJElEQVRoge2a23aqMBCGQ4KGKgVFrbblUFFa8f0fcIeDMgE2EBGcC/61XEgSkw8yjJkh5F1o97E/EBw67D92CRIRn8/t9tU4QNvtZ8a1x0SVaLtPuL6wYQmwr3eyw4clwHbkGyXXN9m/mqFWe4LFQcjCSTVp0qRJj4kClc/zokohrSmCzev6VZWjFxId8EiHinjShuty4ZIS6upVuabN8m5tWPwAGF9phRihS02WKfqkfrWQhVqd/q52dtcNUDh/hOut+P2ihitKuNwarnktl6YdfVrmWg/A5YmJoboCl7Yw6AhcoWjDPBUuLR6D6yQMn8VKXEn14FyaLbhWpbIWrjUbgUtYC/9V44rH4HKpNEYtl7FxYLU1xjxGlJptXJwy6OJG4fJYxX1VuYQNtnKp/R+1coWEXfpzCSjDN0h3tFauFa+auCoXY26Qfjs7XclauTSbWX25eFDULbuBtXNtKu5LlWsOL+yvG1g7l2Mv0iNwYopcsoKeXItjdrzkQ8yexKV1Wo413K/cKLzcNa2fxTVn7VhNXNfsEOe+HLh0Va5zcJKre3HlIKv8RgHvqsgVUEaA6a/sflxubul5l5uHuYRfZWBp2ZfLl/0W78NFgRX05TLk0OIHDRd4AkU8gYdLCjdCPFxS2HjBwyX5IB0N12YJ1/UuHi7oDLUlHi4pB0HByK/mAnH2LyYu4CgCRFwwv3TFxAU61zFx2cXK3m3mktbfg3PRIpFjNHMxGPsOzgUchTRTZS7CjNKCdMj1l+C63qtoE1dJs1I+Zyai7SeuV8U8OkXXClwhK8cdUgRqdcBq4bqvnT0VLqc5Hgp7xkMbkPmKFLiONhk0ftxQwm/m7ChwOeW8r6xO09jCdc/4+t25omSaJC4PPqxpGr0DF/xNles2Om/0E0AnN7Ueicu3z/fvK79jPiec3RWLLu2325klLozqVnYiWrLzreac3L2rNasoXps8G5YaRbVFKIkystPF7pqZY0Dyefo+5b81rFb3USkoTFoT33RNn3d5FMfVwy/8Jk2aNCkVzp1WB7T75bDuL8S6HxPr/lW0+33R7o9GuZ/8H/SbRScl8MPoAAAAAElFTkSuQmCC" alt="">\n                                </a>${c}\n                            </div>\n                            ${e.tagline?`<div class="tagline noselect">${e.tagline}</div>`:""}\n                            <div class="overview noselect"><br>\n                                <div class="title">Overview</div>\n                                <div class="text">${e.overview}</div>\n                            </div>\n                        </div>`),$(".details .extra .wish").unbind(),$(".details .extra .wish").click(e=>{if($(e.target).hasClass("my-heart-empty")){$(e.target).removeClass("my-heart-empty"),$(e.target).addClass("my-heart");let t=getWish();t.data.push(lastOne),setWish(t),$(".header .wish").hasClass("active")&&showWish(getWish())}else{$(e.target).removeClass("my-heart"),$(e.target).addClass("my-heart-empty");let a=getWish();for(var t=0;t<a.data.length;t++)if(a.data[t].id===lastOne.id){a.data.splice(t,1);break}setWish(a),$(".header .wish").hasClass("active")&&showWish(getWish())}}),$(".details .extra .my-youtube").unbind(),$(".details .extra .my-youtube").click(e=>{$(".tube .tube-cover").append(`<iframe width="100%" height="100%" \n\t\tsrc="https://www.youtube.com/embed/${$(e.target).attr("data-id")}?autoplay=1" \n\t\ttitle="YouTube video player" frameborder="0" allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture" \n\t\tallowfullscreen></iframe>`),$(".tube").fadeIn(300)})})},widthCheck=()=>{$(".posts").height()<$(window).height()&&"search"!=currentTab&&(fetchActive||(widthCount=1,getData(currentTab)))},getWish=()=>{if("undefined"!=typeof Storage)return localStorage.getItem("wish")?JSON.parse(localStorage.getItem("wish")):(setWish({data:[]}),getWish())},setWish=e=>{"undefined"!=typeof Storage&&localStorage.setItem("wish",JSON.stringify(e))},showWish=e=>{let t="";if($(".posts").empty(),e.data.length>0){for(let a of e.data)t+=formatData(a);$(".posts").append(t),eventHandeler()}else $(".posts").append("<br><br><br><br><h1>Wishlist is empty</h1>")},load=e=>{"rm"==e?$("#main").children(".load").remove():($("#main").children(".load").remove(),$("#main").append('<div class="load">\n\t\t\t<div class="load-div"><div class="loader"></div></div>\n\t\t</div>'))},getSearchData=async()=>{let e=(new Date).getFullYear(),t="";for(let a=0;a<30;a++)t+=`<option value="${e-a}">${e-a}</option>`;$("#year").append(t),fetch("/api/countries").then(e=>e.json()).then(e=>{let t="";e.sort((e,t)=>e.english_name>t.english_name?1:t.english_name>e.english_name?-1:0),e.forEach(e=>t+=`<option value="${e.iso_3166_1}">${e.english_name}</option>`),$("#region").append(t)}).catch(e=>{}),fetch("/api/languages").then(e=>e.json()).then(e=>{let t="";e.shift(),e.sort((e,t)=>e.english_name>t.english_name?1:t.english_name>e.english_name?-1:0),e.forEach(e=>t+=`<option value="${e.iso_639_1}">${e.english_name}</option>`),$("#lang").append(t)}).catch(e=>{}),fetch("/api/genres").then(e=>e.json()).then(e=>{let t="";e.genres.sort((e,t)=>e.name>t.name?1:t.name>e.name?-1:0),e.genres.forEach(e=>t+=`<option value="${e.id}">${e.name}</option>`),$("#genre").append(t)}).catch(e=>{})};
